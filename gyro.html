<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GyroMouse - Motion Controller Demo</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --panel-color: #1e293b;
            --accent-color: #06b6d4;
            --accent-glow: rgba(6, 182, 212, 0.4);
            --text-color: #e2e8f0;
            --text-muted: #94a3b8;
            --danger-color: #ef4444;
            --success-color: #22c55e;
            --cursor-size: 24px;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Prevent text selection while tilting */
            -webkit-user-select: none;
            touch-action: none; /* Prevent scroll/zoom */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            padding: 1rem;
            background-color: var(--panel-color);
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 12px;
            background: #334155;
            color: var(--text-muted);
            transition: all 0.3s ease;
        }

        .status-badge.active {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success-color);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.2);
        }

        /* --- Main Trackpad Area --- */
        main {
            flex: 1;
            position: relative;
            background-image: 
                radial-gradient(circle, #334155 1px, transparent 1px),
                radial-gradient(circle, #1e293b 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .trackpad-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            pointer-events: none;
        }

        .grid-cell {
            border: 1px solid rgba(255, 255, 255, 0.03);
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(255, 255, 255, 0.1);
            font-size: 2rem;
        }

        /* The Virtual Cursor */
        #cursor {
            width: var(--cursor-size);
            height: var(--cursor-size);
            background-color: var(--accent-color);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px var(--accent-glow), inset 0 0 4px white;
            pointer-events: none; /* Let clicks pass through */
            z-index: 5;
            transition: width 0.1s, height 0.1s;
        }

        #cursor.clicking {
            background-color: #fff;
            transform: translate(-50%, -50%) scale(1.2);
        }

        /* --- Overlay for Initialization --- */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            transition: opacity 0.5s ease;
        }

        #overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .start-btn {
            background: var(--accent-color);
            color: #000;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 20px var(--accent-glow);
            margin-top: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-btn:active {
            transform: scale(0.95);
        }

        /* --- Control Panel (Bottom) --- */
        #controls {
            background-color: var(--panel-color);
            padding: 1rem;
            border-top: 1px solid #334155;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 10;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .data-value {
            color: var(--accent-color);
        }

        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #334155;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .action-btn {
            background: #334155;
            color: white;
            border: 1px solid #475569;
            padding: 12px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
        }

        .action-btn.primary {
            background: var(--accent-color);
            color: #0f172a;
            border: none;
            font-weight: bold;
        }

        /* --- Toast Notifications --- */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid #475569;
            color: var(--text-color);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease-out forwards;
            opacity: 0;
            transform: translateY(-20px);
        }

        @keyframes slideDown {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Guide graphics */
        .guide-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: tiltDemo 2s infinite ease-in-out;
        }

        @keyframes tiltDemo {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }

    </style>
</head>
<body>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Initialization Overlay -->
    <div id="overlay">
        <div class="guide-icon">üì±</div>
        <h2>Motion Mouse Setup</h2>
        <p style="color: var(--text-muted); margin-bottom: 2rem;">
            To use this demo, we need permission to access your device's motion sensors (Gyroscope/Accelerometer).
        </p>
        <button id="initBtn" class="start-btn">Initialize Sensors</button>
        <p style="font-size: 0.8rem; color: #64748b; margin-top: 2rem;">
            Note: Requires HTTPS or Localhost.
        </p>
    </div>

    <!-- Header -->
    <header>
        <h1>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
            GyroMouse
        </h1>
        <div id="statusBadge" class="status-badge">Standby</div>
    </header>

    <!-- Main Trackpad -->
    <main id="trackpadArea">
        <div class="trackpad-grid">
            <div class="grid-cell">‚Üë</div>
            <div class="grid-cell">‚Üë</div>
            <div class="grid-cell">‚Üë</div>
            <div class="grid-cell">‚Üê</div>
            <div class="grid-cell">‚Ä¢</div>
            <div class="grid-cell">‚Üí</div>
            <div class="grid-cell">‚Üì</div>
            <div class="grid-cell">‚Üì</div>
            <div class="grid-cell">‚Üì</div>
        </div>
        <div id="cursor"></div>
    </main>

    <!-- Controls & Debug -->
    <section id="controls">
        <!-- Real-time Data -->
        <div class="data-row">
            <span>Alpha (Z): <span id="valAlpha" class="data-value">0.00</span></span>
            <span>Beta (X): <span id="valBeta" class="data-value">0.00</span></span>
            <span>Gamma (Y): <span id="valGamma" class="data-value">0.00</span></span>
        </div>

        <!-- Sensitivity Slider -->
        <div class="slider-group">
            <div class="slider-label">
                <span>Sensitivity</span>
                <span id="sensVal">5</span>
            </div>
            <input type="range" id="sensitivitySlider" min="1" max="20" value="5" step="0.5">
        </div>

        <!-- Buttons -->
        <div class="action-buttons">
            <button id="calibrateBtn" class="action-btn">üéØ Recenter</button>
            <button id="clickBtn" class="action-btn primary">üñ±Ô∏è Click</button>
        </div>
    </section>

    <script>
        // --- Configuration & State ---
        const state = {
            isActive: false,
            // Sensor offsets (calibration)
            offset: { alpha: 0, beta: 0, gamma: 0 },
            // Current sensor values (raw)
            current: { alpha: 0, beta: 0, gamma: 0 },
            // Cursor position (percentage 0-100)
            pos: { x: 50, y: 50 },
            // Physics settings
            sensitivity: 5,
            maxVelocity: 20 // Cap speed to prevent losing cursor
        };

        // --- DOM Elements ---
        const els = {
            overlay: document.getElementById('overlay'),
            initBtn: document.getElementById('initBtn'),
            status: document.getElementById('statusBadge'),
            cursor: document.getElementById('cursor'),
            trackpad: document.getElementById('trackpadArea'),
            values: {
                alpha: document.getElementById('valAlpha'),
                beta: document.getElementById('valBeta'),
                gamma: document.getElementById('valGamma')
            },
            slider: document.getElementById('sensitivitySlider'),
            sensDisplay: document.getElementById('sensVal'),
            calibrateBtn: document.getElementById('calibrateBtn'),
            clickBtn: document.getElementById('clickBtn'),
            toastContainer: document.getElementById('toast-container')
        };

        // --- Interaction Logic ---

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            if (type === 'error') toast.style.borderColor = 'var(--danger-color)';
            if (type === 'success') toast.style.borderColor = 'var(--success-color)';
            
            els.toastContainer.appendChild(toast);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateStatus(active) {
            state.isActive = active;
            if (active) {
                els.status.textContent = "Active";
                els.status.classList.add('active');
            } else {
                els.status.textContent = "Standby";
                els.status.classList.remove('active');
            }
        }

        function calibrate() {
            // Set the current raw readings as the new "zero" point
            // Note: We use a snapshot of the *current* event values stored in state.current
            state.offset.alpha = state.current.alpha;
            state.offset.beta = state.current.beta;
            state.offset.gamma = state.current.gamma;
            
            showToast("Calibrated: Current angle is now Center", "success");
        }

        // --- Core Sensor Loop ---

        function handleOrientation(event) {
            // 1. Capture Raw Data
            // Beta: Front to back tilt (-180 to 180) -> Used for Y axis (Up/Down)
            // Gamma: Left to right tilt (-90 to 90) -> Used for X axis (Left/Right)
            
            let alpha = event.alpha || 0;
            let beta = event.beta || 0;
            let gamma = event.gamma || 0;

            // Store raw state
            state.current = { alpha, beta, gamma };

            // Update UI Numbers
            els.values.alpha.textContent = alpha.toFixed(2);
            els.values.beta.textContent = beta.toFixed(2);
            els.values.gamma.textContent = gamma.toFixed(2);
        }

        // This runs on every animation frame (approx 60fps)
        // We separate physics calculation from the event listener for smoothness
        function gameLoop() {
            if (!state.isActive) {
                requestAnimationFrame(gameLoop);
                return;
            }

            // 2. Calculate Relative Tilt (Apply Calibration)
            // We want to know the difference from the "resting" angle
            const relBeta = state.current.beta - state.offset.beta;
            const relGamma = state.current.gamma - state.offset.gamma;

            // 3. Convert Tilt to Velocity
            // If phone is tilted 45 degrees, move at full speed? 
            // We'll use a multiplier.
            const velocityX = relGamma * (state.sensitivity * 0.05);
            const velocityY = relBeta * (state.sensitivity * 0.05);

            // 4. Update Position
            state.pos.x += velocityX;
            state.pos.y += velocityY;

            // 5. Boundary Checks (Clamp between 0 and 100%)
            if (state.pos.x < 0) state.pos.x = 0;
            if (state.pos.x > 100) state.pos.x = 100;
            if (state.pos.y < 0) state.pos.y = 0;
            if (state.pos.y > 100) state.pos.y = 100;

            // 6. Render Cursor
            els.cursor.style.left = `${state.pos.x}%`;
            els.cursor.style.top = `${state.pos.y}%`;

            requestAnimationFrame(gameLoop);
        }

        // --- Initialization ---

        async function initSensors() {
            // iOS 13+ requires permission request. Android usually just works or also requires permission.
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState === 'granted') {
                        startListening();
                    } else {
                        showToast("Permission denied. Cannot access motion sensors.", "error");
                    }
                } catch (error) {
                    console.error(error);
                    // Usually occurs if not triggered by user action (click)
                    showToast("Error requesting permission. Try reloading.", "error");
                }
            } else {
                // Non-iOS 13+ devices (Android, older iOS)
                startListening();
            }
        }

        function startListening() {
            window.addEventListener('deviceorientation', handleOrientation);
            
            els.overlay.classList.add('hidden');
            updateStatus(true);
            showToast("Sensors Active! Tilt phone to move.", "success");
            
            // Initial calibration after a short delay to let sensors settle
            setTimeout(calibrate, 500);
            
            // Start the render loop
            requestAnimationFrame(gameLoop);
        }

        // --- Event Listeners ---

        els.initBtn.addEventListener('click', initSensors);

        els.calibrateBtn.addEventListener('click', () => {
            calibrate();
            // Also reset cursor position to center visually
            state.pos.x = 50;
            state.pos.y = 50;
        });

        els.slider.addEventListener('input', (e) => {
            state.sensitivity = parseFloat(e.target.value);
            els.sensDisplay.textContent = state.sensitivity;
        });

        // Click simulation
        const triggerClick = () => {
            els.cursor.classList.add('clicking');
            showToast("Click Triggered", "info");
            // Add vibration feedback if supported
            if (navigator.vibrate) navigator.vibrate(50);
            
            setTimeout(() => {
                els.cursor.classList.remove('clicking');
            }, 150);
        };

        els.clickBtn.addEventListener('mousedown', triggerClick);
        els.clickBtn.addEventListener('touchstart', (e) => {
            e.preventDefault(); // prevent mouse emulation
            triggerClick();
        });

        // Handle Window Resize (re-clamp logic is handled in loop, but good for future expansion)
        window.addEventListener('resize', () => {
            // Reset to center on resize to avoid losing cursor off-screen
            state.pos.x = 50;
            state.pos.y = 50;
        });

    </script>
</body>
</html>