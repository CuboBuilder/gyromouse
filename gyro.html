<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Motion Mouse Debug</title>
    <style>
        body {
            font-family: monospace;
            background-color: #121212;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        h2 { margin-top: 0; text-align: center; color: white; }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            background: #1e1e1e;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .data-box {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            text-align: center;
        }

        .data-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
            display: block;
        }

        .data-value {
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* The Trackpad Area */
        #trackpad {
            flex: 1;
            background: #252525;
            border: 2px dashed #444;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        /* The Virtual Mouse Cursor */
        #cursor {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #ff0055 20%, transparent 20%);
            border: 2px solid #ff0055;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            box-shadow: 0 0 15px #ff0055;
            transition: transform 0.05s linear; /* Smooth movement */
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 15px;
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
        }

        button:active { background: #555; }
        button.primary { background: #007bff; border-color: #0056b3; }

        #warning {
            color: yellow;
            text-align: center;
            font-size: 0.8rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <h2>Android Sensor Mouse</h2>

    <!-- Raw Data Display -->
    <div class="container">
        <div class="data-box">
            <span class="data-label">Alpha (Z)</span>
            <span id="alpha" class="data-value">0°</span>
        </div>
        <div class="data-box">
            <span class="data-label">Beta (X)</span>
            <span id="beta" class="data-value">0°</span>
        </div>
        <div class="data-box">
            <span class="data-label">Gamma (Y)</span>
            <span id="gamma" class="data-value">0°</span>
        </div>
        <div class="data-box">
            <span class="data-label">Acc X</span>
            <span id="accelX" class="data-value">0</span>
        </div>
    </div>

    <!-- Visual Trackpad -->
    <div id="trackpad">
        <div id="cursor"></div>
    </div>

    <div id="warning">If values stay at 0, you must use HTTPS (localhost or ngrok).</div>

    <div class="controls">
        <button id="btnStart" class="primary">Start Sensor Connection</button>
        <button id="btnReset">Recenter</button>
    </div>

    <script>
        // --- Configuration ---
        let sensitivity = 3.0; // Adjust this to make mouse faster or slower
        let centerX = 50; // Percentage
        let centerY = 50; // Percentage
        let currentX = 50;
        let currentY = 50;
        
        // Elements
        const cursor = document.getElementById('cursor');
        const btnStart = document.getElementById('btnStart');
        const btnReset = document.getElementById('btnReset');
        const warning = document.getElementById('warning');

        // State
        let isRunning = false;

        // --- Your Snippet Integration ---
        function handleOrientation(event) {
            // 1. Update Raw Data UI
            document.getElementById("alpha").textContent = Math.round(event.alpha) + "°";
            document.getElementById("beta").textContent = Math.round(event.beta) + "°";
            document.getElementById("gamma").textContent = Math.round(event.gamma) + "°";

            // 2. Move Mouse Logic
            if (isRunning) {
                // Beta: Front/Back Tilt (-180 to 180). Negative usually means "Top tilting away".
                // Gamma: Left/Right Tilt (-90 to 90).
                
                let beta = event.beta; 
                let gamma = event.gamma;

                // Simple velocity-based movement
                // We add the tilt amount to the current position
                // The sensitivity multiplier makes it move faster
                
                // Check if values are null (sometimes happens on init)
                if(beta === null) beta = 0;
                if(gamma === null) gamma = 0;

                // Move X based on Gamma (Left/Right)
                // Gamma > 0 (Right) -> Increase X
                currentX += gamma * 0.1 * sensitivity;

                // Move Y based on Beta (Front/Back)
                // Beta < 0 (Up/Away) -> Decrease Y (screen coords: 0 is top)
                currentY += beta * 0.1 * sensitivity;

                // Clamp to screen (0% to 100%)
                if (currentX < 0) currentX = 0;
                if (currentX > 100) currentX = 100;
                if (currentY < 0) currentY = 0;
                if (currentY > 100) currentY = 100;

                // Apply to DOM
                cursor.style.left = currentX + "%";
                cursor.style.top = currentY + "%";
            }
        }

        function handleMotion(event) {
            // accelerationIncludingGravity provides acceleration with gravity included
            const acc = event.accelerationIncludingGravity; 
            if (acc) {
                document.getElementById("accelX").textContent = Math.round(acc.x) + " m/s²";
                // We can add Accel Y/Z to UI if needed
            }
        }

        // --- Initialization ---

        function startSensors() {
            // 1. Add Listeners (Using your exact syntax)
            window.addEventListener("deviceorientation", handleOrientation, true);
            window.addEventListener("devicemotion", handleMotion, true);

            // 2. iOS 13+ Permission Handling (Required even if testing on Android occasionally, 
            // or if you switch to iPhone later)
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') {
                            isRunning = true;
                            btnStart.textContent = "Sensors Active";
                            btnStart.disabled = true;
                            resetPosition();
                        } else {
                            alert("Permission denied");
                        }
                    })
                    .catch(console.error);
            } else {
                // Non-iOS 13+ devices (Standard Android)
                isRunning = true;
                btnStart.textContent = "Sensors Active";
                btnStart.disabled = true;
                resetPosition();
                
                // Visual feedback that we are listening
                warning.textContent = "Listening for motion... Tilt your phone.";
                warning.style.color = "#00ff00";
            }
        }

        function resetPosition() {
            currentX = 50;
            currentY = 50;
            cursor.style.left = "50%";
            cursor.style.top = "50%";
        }

        // Button Events
        btnStart.addEventListener('click', startSensors);
        btnReset.addEventListener('click', resetPosition);

    </script>
</body>
</html>
